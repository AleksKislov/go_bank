# API Банковского Сервиса

REST API для банковского сервиса с функциями управления счетами, операциями с картами, переводами, обработкой кредитов и аналитикой.

## Возможности

- Регистрация и аутентификация пользователей с помощью JWT
- Управление счетами (создание, получение, обновление, удаление)
- Операции с картами (создание, управление, платежи)
- Денежные переводы между счетами
- Обработка кредитов (оформление кредита, график платежей, автоматические платежи)
- Финансовая аналитика (статистика, прогноз баланса, кредитная аналитика)
- Безопасная обработка данных (шифрование PGP, HMAC, bcrypt)
- Интеграция с API Центрального Банка для определения ключевой ставки

## Требования

- Go 1.20+
- PostgreSQL 15 с расширением pgcrypto
- Переменные окружения (см. раздел Конфигурация)

## Установка

1. Склонируйте репозиторий:

```
git clone https://github.com/yourusername/banking-service.git
cd banking-service
```

2. Установите зависимости:

```
go mod download
```

3. Настройте базу данных PostgreSQL:

```
docker compose up -d
```

4. Настройте БД - см. файл schema.sql
5. Настройте переменные окружения или создайте файл .env (см. раздел Конфигурация)
    
6. Соберите приложение:
    

```
go build -o banking-service ./cmd/api
```

6. Запустите приложение:

```
./banking-service
```

## Конфигурация

Следующие переменные окружения используются для конфигурации:

### Сервер

- `SERVER_PORT` - порт HTTP-сервера (по умолчанию: 8080)

### База данных

- `DB_HOST` - хост PostgreSQL (по умолчанию: localhost)
- `DB_PORT` - порт PostgreSQL (по умолчанию: 5432)
- `DB_USER` - пользователь PostgreSQL (по умолчанию: postgres)
- `DB_PASSWORD` - пароль PostgreSQL (по умолчанию: postgres)
- `DB_NAME` - название базы данных PostgreSQL (по умолчанию: banking_service)

### JWT

- `JWT_SECRET` - секретный ключ для подписи JWT токенов (по умолчанию: super_secret_key)
- `JWT_TTL` - время жизни JWT токена в часах (по умолчанию: 24)

### Email

- `SMTP_HOST` - хост SMTP-сервера
- `SMTP_PORT` - порт SMTP-сервера (по умолчанию: 587)
- `SMTP_USER` - имя пользователя SMTP-сервера
- `SMTP_PASSWORD` - пароль SMTP-сервера
- `SENDER_EMAIL` - адрес электронной почты отправителя

### Шифрование PGP

- `PGP_PUBLIC_KEY` - публичный ключ PGP для шифрования
- `PGP_PRIVATE_KEY` - приватный ключ PGP для расшифровки
- `PGP_PASSPHRASE` - пароль для приватного ключа PGP

### API ЦБ РФ

- `CBR_API_URL` - URL API Центрального Банка России

## API

### Аутентификация

- `POST /register` - Регистрация нового пользователя
- `POST /login` - Вход и получение JWT токена

### Счета

- `POST /api/accounts` - Создание нового счета
- `GET /api/accounts` - Получение всех счетов пользователя
- `GET /api/accounts/{id}` - Получение счета по ID
- `PUT /api/accounts/{id}/balance` - Обновление баланса счета (пополнение)
- `DELETE /api/accounts/{id}` - Удаление счета

### Карты

- `POST /api/cards` - Создание новой карты
- `GET /api/cards` - Получение всех карт пользователя
- `GET /api/cards?account_id={id}` - Получение всех карт для счета
- `GET /api/cards/{id}` - Получение карты по ID
- `PUT /api/cards/{id}` - Обновление статуса карты
- `DELETE /api/cards/{id}` - Удаление карты

### Транзакции

- `POST /api/transfer` - Перевод денег между счетами
- `POST /api/pay` - Оплата с использованием карты
- `GET /api/transactions` - Получение всех транзакций пользователя
- `GET /api/transactions?start_date={date}&end_date={date}` - Получение транзакций за период
- `GET /api/transactions/{id}` - Получение транзакции по ID
- `GET /api/accounts/{id}/transactions` - Получение транзакций для счета

### Кредиты

- `POST /api/credits` - Оформление кредита
- `GET /api/credits` - Получение всех кредитов пользователя
- `GET /api/credits/{id}` - Получение кредита по ID
- `GET /api/credits/{id}/schedule` - Получение графика платежей для кредита
- `GET /api/key-rate` - Получение текущей ключевой ставки Центрального Банка

### Аналитика

- `GET /api/analytics?period={period}` - Получение финансовой статистики (период: week, month, quarter, year)
- `GET /api/accounts/{id}/predict?days={days}` - Прогноз баланса счета на будущие дни
- `GET /api/credit-analytics` - Получение кредитной аналитики

## Безопасность данных

Приложение реализует несколько мер безопасности:

- Хеширование паролей с использованием bcrypt
- Аутентификация на основе JWT
- Шифрование PGP для чувствительных данных карт
- HMAC для проверки целостности данных
- Расширение PostgreSQL pgcrypto для дополнительных возможностей шифрования
